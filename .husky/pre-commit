#!/usr/bin/env sh

# Strict pre-commit hooks to prevent commits with any linting or test failures
set -e

echo "ğŸ” Running pre-commit checks..."

# 1. Run type checking
echo "ğŸ“‹ Type checking..."
npm run type-check
if [ $? -ne 0 ]; then
  echo "âŒ Type check failed! Please fix TypeScript errors before committing."
  exit 1
fi

# 2. Run linter (strict mode - no warnings allowed)
echo "ğŸ”§ Linting..."
npm run lint -- --max-warnings 0
if [ $? -ne 0 ]; then
  echo "âŒ Linting failed! Please fix all ESLint errors and warnings before committing."
  exit 1
fi

# 3. Run tests
echo "ğŸ§ª Testing..."
npm run test run
if [ $? -ne 0 ]; then
  echo "âŒ Tests failed! Please fix all failing tests before committing."
  exit 1
fi

# 4. Run lint-staged for formatting
echo "ğŸ’… Formatting staged files..."
npx lint-staged --allow-empty

echo "âœ… All pre-commit checks passed!"
