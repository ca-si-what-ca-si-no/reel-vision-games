#!/usr/bin/env sh

# Strict pre-commit hooks to prevent commits with any linting or test failures
set -e

echo "🔍 Running pre-commit checks..."

# 1. Run type checking
echo "📋 Type checking..."
npm run type-check
if [ $? -ne 0 ]; then
  echo "❌ Type check failed! Please fix TypeScript errors before committing."
  exit 1
fi

# 2. Run linter (strict mode - no warnings allowed)
echo "🔧 Linting..."
npm run lint -- --max-warnings 0
if [ $? -ne 0 ]; then
  echo "❌ Linting failed! Please fix all ESLint errors and warnings before committing."
  exit 1
fi

# 3. Run tests
echo "🧪 Testing..."
npm run test run
if [ $? -ne 0 ]; then
  echo "❌ Tests failed! Please fix all failing tests before committing."
  exit 1
fi

# 4. Run lint-staged for formatting
echo "💅 Formatting staged files..."
npx lint-staged --allow-empty

echo "✅ All pre-commit checks passed!"
